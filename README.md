# OLAS Household Survey Data Set
This repository contains files and scripts used to create the OLAS Household Survey Data Set. 

## Inputs 

### Outside inputs
* input_data_2019: Includes harmonized household surveys from the IDBs SCL Data Lake. 
* ref_2019.csv: Includes a list of all variables from the harmonized data sets to be incorporated into the master.
* input_data_2020: Includes harmonized household surveys from the IDBs SCL Data Lake (countries to be incorporated or updated). 
* ref_2020.csv: Includes a list of all variables from the harmonized data sets to be incorporated into the master.
* population_2019.csv: Includes population data for years surveyed for each country in the 2019 files.
* population_2020.csv: Includes population data for years surveyed for each country in the 2020 files. 

### Inputs generated by scripts
* master_2019.rda : this file is generated by **create_2019_master.R**
* master_2020.rda : this file is generated by **create_2020_master.R**
* olas_2019_wide.rda : this file is generated by **create_2019_summary.R**
* olas_2020_wide.rda : this file is generated by **create_2020_summary.R**

This repository does not include the original data files due to size limitations and data privacy rules from some participating countries.

These files are placed in folders referenced by create_2019_master.R and create_2020_master.R. These scripts also reference the ref csvs (**ref_2019.csv** and **ref_2020.csv** to extract relevant variables for future processing from the larger country data sets. 
The output of these scripts are **master_2019.rda** and **master_2020.rda** respectively, which are in turn used as inputs to **create_2019_summary.R** and **create_2020_summary.R**. These files also use **population_2019.csv** and **popualtion_2020.csv** as inputs, respectively.
If users need to rerun the code but do not wish to change something in the master files, it is recommended that they just run **create_2019_summary.R** and **create_2020_summary.R**, utlizing these data files as inputs.  

**create_2019_summary.R** and **create_2020_summary.R** generate two data sets, **olas_2019_wide.rda** and **olas_2020_wide.rda** which in turn are used as inputs to the **merge_old_and_new.R** script.

## Scripts
The following are the primary scripts, in the order in which they should be run: 

* create_2019_master.R
* create_2019_summary.R
* create_2020_master.R
* create_2020_summary.R
* merge_2019_2020.R


### Creating the master data sets
#### create_2019_master.R

**create_2019_master.R** combines harmonized country household survey data sets and their variables of interest into one master data set for the first round of data produced for the data set. 
It references the input_data_2019 folder and a **ref_2019.csv** file which contains the variables for each data set that are of interest and the full list of harmonized household surveys files. 
. 

#### create_2020_master.R

**create_2020_master.R** combines harmonized country household survey data sets and their variables of interest into one master data set for the second round of data (2020) produced for the data set. 
It references the input_data_2020 folder and a **ref_2020.csv** file which contains the variables for each data set that are of interest and the full list of harmonized household surveys files. 

### Summarizing the data
#### create_2019_summary.R
**create_2019_summary.R** creates income quintiles and population data and generates indicators of interest broken down by gender of the head of household, income quintiles, and zone (rural/urban). 
This is an update of a previously generated data set that follows more precisely the JMP definitions for improved water sources. 

#### create_2020_summary.R
**create_2020_summary.R** creates income quintiles and population data and generates indicators of interest broken down by various dimensions. 

### Combining the data
**merge_2019_2020** merges the two summary data sets together to create a master data set (**olas_harmonized_hh_surveys_wide.csv** and **olas_harmonized_hh_surveys_long.csv**) and a series of data sets with the characteristics necessary to upload information to the existing OLAS site (**OLAS_harmonized_hh_surveys.csv** & the files in the **country_files** folder). 

## Outputs
The output data is saved in the output_data folder. 

It contains two full datasets in csv format:
* olas_harmonized_hh_surveys_wide.csv 
* olas_harmonized_hh_surveys_long.csv 

These data sets are identical apart from their format, the appropriate file depends on user preference. They contain all information on all countries in the data set, and the metrics of the data set in two different sets of units: percent population, and percent household. The metrics are named with the corresponding suffix (__pop for population percentages and __hh for household percentages). If users want to generate population numbers for each indicator they should use the metrics in population units and multiply them by the population percent field (population_perc) and the total population of the country (population). 

The output_data folder also the country_files folder, which has data sets by country and year. These only include household level data. 



